<!DOCTYPE html>
<html lang="en">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<head>
  <title>L2DF Documentation</title>

  <link rel="apple-touch-icon" sizes="57x57" href="/favicon/apple-icon-57x57.png" />
  <link rel="apple-touch-icon" sizes="60x60" href="/favicon/apple-icon-60x60.png" />
  <link rel="apple-touch-icon" sizes="72x72" href="/favicon/apple-icon-72x72.png" />
  <link rel="apple-touch-icon" sizes="76x76" href="/favicon/apple-icon-76x76.png" />
  <link rel="apple-touch-icon" sizes="114x114" href="/favicon/apple-icon-114x114.png" />
  <link rel="apple-touch-icon" sizes="120x120" href="/favicon/apple-icon-120x120.png" />
  <link rel="apple-touch-icon" sizes="144x144" href="/favicon/apple-icon-144x144.png" />
  <link rel="apple-touch-icon" sizes="152x152" href="/favicon/apple-icon-152x152.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-icon-180x180.png" />
  <link rel="icon" type="image/png" sizes="192x192" href="/favicon/android-icon-192x192.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="96x96" href="/favicon/favicon-96x96.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png" />
  <link rel="manifest" href="/favicon/manifest.json" />
  <meta name="msapplication-TileColor" content="#ffffff" />
  <meta name="msapplication-TileImage" content="favicon/ms-icon-144x144.png" />
  <meta name="theme-color" content="#ffffff" />
  <meta name="color-scheme" content="dark light" />

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" type="text/css" />
  <link rel="stylesheet" href="../ldoc.css" type="text/css" />
</head>
<body>



<div id="container">

  <div class="header" id="header">
    <div class="header__logo">
      <a href="../index.html"></a>
    </div>
    <div class="header__nav">
      <ul class="nav nav__docs">
        <li class="nav__item nav__link__active">
          <a class="nav__link" href="../manual/readme.md.html">Docs</a>
        </li>
        <li class="nav__item ">
          <a class="nav__link" href="../index.html">API Reference</a>
        </li>
        <li class="nav__item ">
          <a class="nav__link" href="https://github.com/atom-tm/l2df-engine/issues">Support</a>
        </li>
      </ul>
    </div>
    <div class="header__theme">
      <div class="theme">
        <div class="theme-btn theme-btn__light">
          <svg role="img" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 18.2125C15.431 18.2125 18.2124 15.4311 18.2124 12C18.2124 8.56896 15.431 5.78754 12 5.78754C8.5689 5.78754 5.78748 8.56896 5.78748 12C5.78748 15.4311 8.5689 18.2125 12 18.2125Z" fill="#FFE07D"/>
            <path d="M12 18.2125C15.431 18.2125 18.2124 15.4311 18.2124 12C18.2124 8.56896 15.431 5.78754 12 5.78754C8.5689 5.78754 5.78748 8.56896 5.78748 12C5.78748 15.4311 8.5689 18.2125 12 18.2125Z" fill="#FFE07D"/>
            <path d="M12 5.78754C11.8184 5.78754 11.6386 5.79579 11.4609 5.81107C14.6395 6.08435 17.1344 8.75065 17.1344 12C17.1344 15.2494 14.6395 17.9157 11.4609 18.189C11.6386 18.2043 11.8184 18.2125 12 18.2125C15.4311 18.2125 18.2125 15.4311 18.2125 12C18.2125 8.56896 15.4311 5.78754 12 5.78754Z" fill="#FFD064"/>
            <path d="M12 4.58597C11.8058 4.58597 11.6484 4.42856 11.6484 4.23441V0.351563C11.6484 0.157406 11.8058 0 12 0C12.1942 0 12.3516 0.157406 12.3516 0.351563V4.23441C12.3516 4.42856 12.1942 4.58597 12 4.58597Z" fill="#FFE07D"/>
            <path d="M6.50885 6.86045C6.41885 6.86045 6.3289 6.82614 6.26027 6.75746L3.51472 4.0119C3.37742 3.87461 3.37742 3.652 3.51472 3.51475C3.65201 3.37745 3.87462 3.37745 4.01187 3.51475L6.75743 6.26031C6.89473 6.39761 6.89473 6.62021 6.75743 6.75746C6.6888 6.82614 6.5988 6.86045 6.50885 6.86045Z" fill="#FFE07D"/>
            <path d="M4.23441 12.3516H0.351563C0.157406 12.3516 0 12.1942 0 12C0 11.8058 0.157406 11.6484 0.351563 11.6484H4.23441C4.42856 11.6484 4.58597 11.8058 4.58597 12C4.58597 12.1942 4.42856 12.3516 4.23441 12.3516Z" fill="#FFE07D"/>
            <path d="M3.76329 20.5883C3.67329 20.5883 3.58334 20.554 3.51472 20.4853C3.37742 20.348 3.37742 20.1254 3.51472 19.9881L6.26027 17.2426C6.39757 17.1053 6.62018 17.1053 6.75743 17.2426C6.89473 17.3799 6.89473 17.6025 6.75743 17.7398L4.01187 20.4853C3.94325 20.5539 3.85329 20.5883 3.76329 20.5883Z" fill="#FFE07D"/>
            <path d="M12 24C11.8058 24 11.6484 23.8426 11.6484 23.6484V19.7656C11.6484 19.5715 11.8058 19.4141 12 19.4141C12.1942 19.4141 12.3516 19.5715 12.3516 19.7656V23.6484C12.3516 23.8426 12.1942 24 12 24Z" fill="#FFE07D"/>
            <path d="M20.2366 20.5882C20.1467 20.5882 20.0567 20.5539 19.9881 20.4853L17.2425 17.7397C17.1052 17.6024 17.1052 17.3798 17.2425 17.2425C17.3798 17.1052 17.6024 17.1052 17.7397 17.2425L20.4852 19.9881C20.6225 20.1254 20.6225 20.348 20.4852 20.4852C20.4166 20.5539 20.3266 20.5882 20.2366 20.5882Z" fill="#FFE07D"/>
            <path d="M23.6484 12.3516H19.7656C19.5715 12.3516 19.4141 12.1942 19.4141 12C19.4141 11.8058 19.5715 11.6484 19.7656 11.6484H23.6484C23.8426 11.6484 24 11.8058 24 12C24 12.1942 23.8426 12.3516 23.6484 12.3516Z" fill="#FFE07D"/>
            <path d="M17.4911 6.86045C17.4011 6.86045 17.3111 6.82614 17.2425 6.75746C17.1052 6.62017 17.1052 6.39756 17.2425 6.26031L19.9881 3.51475C20.1254 3.37745 20.348 3.37745 20.4852 3.51475C20.6225 3.65204 20.6225 3.87465 20.4852 4.0119L17.7397 6.75746C17.671 6.82614 17.5811 6.86045 17.4911 6.86045Z" fill="#FFE07D"/>
            <path d="M9.02841 5.17717C8.89046 5.17717 8.75958 5.09542 8.70348 4.96004L7.96051 3.16642C7.88621 2.98703 7.97138 2.78139 8.15077 2.70709C8.33012 2.63279 8.53576 2.71796 8.6101 2.89735L9.35307 4.69098C9.42737 4.87037 9.34219 5.07601 9.1628 5.15031C9.11883 5.16854 9.07323 5.17717 9.02841 5.17717Z" fill="#FFF0AF"/>
            <path d="M4.82531 9.37984C4.78045 9.37984 4.73488 9.37122 4.69092 9.35298L2.89729 8.61002C2.7179 8.53572 2.63273 8.33003 2.70703 8.15069C2.78132 7.9713 2.98701 7.88618 3.16635 7.96043L4.95998 8.70339C5.13937 8.77769 5.22454 8.98338 5.15024 9.16272C5.09418 9.29809 4.96326 9.37984 4.82531 9.37984Z" fill="#FFF0AF"/>
            <path d="M3.03196 16.0664C2.89401 16.0664 2.76309 15.9847 2.70703 15.8493C2.63273 15.6699 2.7179 15.4643 2.89729 15.39L4.69092 14.647C4.87031 14.5727 5.07595 14.6579 5.15024 14.8373C5.22454 15.0166 5.13937 15.2223 4.95998 15.2966L3.16635 16.0396C3.12239 16.0577 3.07682 16.0664 3.03196 16.0664Z" fill="#FFF0AF"/>
            <path d="M8.28516 21.3198C8.24035 21.3198 8.19474 21.3111 8.15077 21.2929C7.97138 21.2186 7.88621 21.0129 7.96051 20.8336L8.70348 19.04C8.77777 18.8606 8.98351 18.7754 9.1628 18.8497C9.34219 18.924 9.42737 19.1297 9.35307 19.309L8.6101 21.1026C8.55404 21.238 8.42312 21.3198 8.28516 21.3198Z" fill="#FFF0AF"/>
            <path d="M15.7149 21.3198C15.5769 21.3198 15.446 21.238 15.3899 21.1026L14.647 19.309C14.5727 19.1296 14.6579 18.924 14.8372 18.8497C15.0166 18.7754 15.2223 18.8606 15.2966 19.04L16.0395 20.8336C16.1138 21.013 16.0286 21.2186 15.8493 21.2929C15.8053 21.3111 15.7597 21.3198 15.7149 21.3198Z" fill="#FFF0AF"/>
            <path d="M20.9679 16.0664C20.9231 16.0664 20.8775 16.0578 20.8336 16.0396L19.0399 15.2966C18.8605 15.2223 18.7754 15.0166 18.8497 14.8373C18.924 14.6579 19.1297 14.5726 19.309 14.647L21.1026 15.39C21.282 15.4643 21.3672 15.6699 21.2929 15.8493C21.2368 15.9847 21.1059 16.0664 20.9679 16.0664Z" fill="#FFF0AF"/>
            <path d="M19.1746 9.37989C19.0366 9.37989 18.9057 9.29814 18.8497 9.16277C18.7754 8.98337 18.8605 8.77773 19.0399 8.70344L20.8336 7.96047C21.013 7.88626 21.2186 7.97134 21.2929 8.15073C21.3672 8.33012 21.282 8.53576 21.1026 8.61006L19.309 9.35303C19.265 9.37127 19.2195 9.37989 19.1746 9.37989Z" fill="#FFF0AF"/>
            <path d="M14.9716 5.17716C14.9268 5.17716 14.8812 5.16853 14.8372 5.1503C14.6578 5.076 14.5727 4.87031 14.647 4.69097L15.3899 2.89734C15.4642 2.71795 15.6699 2.63273 15.8493 2.70708C16.0287 2.78137 16.1138 2.98706 16.0395 3.16641L15.2966 4.96003C15.2405 5.09541 15.1096 5.17716 14.9716 5.17716Z" fill="#FFF0AF"/>
          </svg>
        </div>
        <div class="theme-btn theme-btn__dark">
          <svg role="img" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M20.789 11.876C19.779 14.2371 17.4323 15.8901 14.7 15.8828C11.0848 15.8732 8.12684 12.9151 8.11723 9.29999C8.10996 6.56774 9.76292 4.22099 12.1241 3.21098C12.3979 3.09384 12.313 2.68176 12.0151 2.68124C12.0101 2.68124 12.0051 2.68124 12 2.68124C6.85343 2.68124 2.68127 6.8534 2.68127 12C2.68127 15.9277 5.11151 19.2873 8.55012 20.6586C8.71952 20.7261 8.91682 20.6701 9.01423 20.5159C9.15968 20.2858 9.42251 20.1374 9.7189 20.1554C10.0676 20.1766 10.3639 20.4377 10.432 20.7803C10.4383 20.8122 10.4425 20.8436 10.4448 20.8747C10.4585 21.0615 10.595 21.2149 10.7808 21.2392C11.1798 21.2915 11.5867 21.3187 12 21.3187C17.1466 21.3187 21.3187 17.1466 21.3187 12C21.3187 11.995 21.3187 11.99 21.3187 11.9849C21.3183 11.6871 20.9062 11.6021 20.789 11.876Z" fill="#B3BBE6"/>
              <path d="M21.3188 11.9849C21.3183 11.687 20.9062 11.6021 20.789 11.876C20.624 12.2618 20.4226 12.6283 20.1903 12.9722C19.7225 17.4843 16.0353 21.0396 11.4654 21.3026C11.6424 21.3126 11.8205 21.3187 12 21.3187C17.1465 21.3187 21.3187 17.1466 21.3187 12C21.3188 11.995 21.3188 11.99 21.3188 11.9849Z" fill="#5165BF"/>
              <path d="M11.0459 3.21098C8.68477 4.22099 7.03182 6.5677 7.03909 9.29999C7.0487 12.9152 10.0067 15.8732 13.6219 15.8828C13.809 15.8833 13.9941 15.8753 14.1774 15.8605C10.804 15.5836 8.12635 12.7393 8.11721 9.29999C8.10995 6.56774 9.7629 4.22099 12.124 3.21098C12.3979 3.09384 12.3129 2.68176 12.0151 2.68124C12.0101 2.68124 12.0051 2.68124 12 2.68124C11.6924 2.68124 11.3884 2.69657 11.0884 2.72568C11.254 2.83513 11.265 3.11723 11.0459 3.21098Z" fill="#5165BF"/>
              <path d="M18.2125 22.5203H17.7876V22.0953C17.7876 21.9012 17.6302 21.7438 17.436 21.7438C17.2418 21.7438 17.0844 21.9012 17.0844 22.0953V22.5203H16.6594C16.4653 22.5203 16.3079 22.6777 16.3079 22.8719C16.3079 23.066 16.4653 23.2234 16.6594 23.2234H17.0844V23.6484C17.0844 23.8426 17.2418 24 17.436 24C17.6302 24 17.7876 23.8426 17.7876 23.6484V23.2234H18.2125C18.4067 23.2234 18.5641 23.066 18.5641 22.8719C18.5641 22.6777 18.4067 22.5203 18.2125 22.5203Z" fill="#B2BBE5"/>
              <path d="M5.39926 15.1063C5.82815 15.1063 6.17584 14.7586 6.17584 14.3297C6.17584 13.9008 5.82815 13.5531 5.39926 13.5531C4.97037 13.5531 4.62268 13.9008 4.62268 14.3297C4.62268 14.7586 4.97037 15.1063 5.39926 15.1063Z" fill="#8796DC"/>
              <path d="M6.47758 11.9404C6.87388 11.7761 7.06198 11.3217 6.89771 10.9254C6.73344 10.5291 6.27902 10.341 5.88272 10.5052C5.48642 10.6695 5.29833 11.1239 5.46259 11.5202C5.62686 11.9165 6.08128 12.1046 6.47758 11.9404Z" fill="#DFE3F2"/>
              <path d="M21.707 17.8609C21.5128 17.8609 21.3555 18.0183 21.3555 18.2125V18.9891C21.3555 19.1833 21.5128 19.3406 21.707 19.3406C21.9012 19.3406 22.0586 19.1833 22.0586 18.9891V18.2125C22.0586 18.0183 21.9012 17.8609 21.707 17.8609Z" fill="#7E8BC8"/>
              <path d="M21.707 20.9672C21.5128 20.9672 21.3555 21.1246 21.3555 21.3188V22.0953C21.3555 22.2895 21.5128 22.4468 21.707 22.4468C21.9012 22.4468 22.0586 22.2895 22.0586 22.0953V21.3188C22.0586 21.1246 21.9012 20.9672 21.707 20.9672Z" fill="#7E8BC8"/>
              <path d="M23.6483 19.8024H22.8718C22.6776 19.8024 22.5203 19.9597 22.5203 20.1539C22.5203 20.3481 22.6776 20.5055 22.8718 20.5055H23.6483C23.8425 20.5055 23.9999 20.3481 23.9999 20.1539C23.9999 19.9597 23.8425 19.8024 23.6483 19.8024Z" fill="#7E8BC8"/>
              <path d="M20.5422 19.8024H19.7656C19.5714 19.8024 19.4141 19.9597 19.4141 20.1539C19.4141 20.3481 19.5714 20.5055 19.7656 20.5055H20.5422C20.7364 20.5055 20.8937 20.3481 20.8937 20.1539C20.8937 19.9597 20.7364 19.8024 20.5422 19.8024Z" fill="#7E8BC8"/>
              <path d="M7.34059 0.776578H6.91557V0.351562C6.91557 0.157406 6.75817 0 6.56401 0C6.36985 0 6.21245 0.157406 6.21245 0.351562V0.776578H5.78748C5.59332 0.776578 5.43591 0.933984 5.43591 1.12814C5.43591 1.3223 5.59332 1.4797 5.78748 1.4797H6.21245V1.90467C6.21245 2.09883 6.36985 2.25623 6.56401 2.25623C6.75817 2.25623 6.91557 2.09883 6.91557 1.90467V1.4797H7.34059C7.53475 1.4797 7.69215 1.3223 7.69215 1.12814C7.69215 0.933984 7.53475 0.776578 7.34059 0.776578Z" fill="#B2BBE5"/>
              <path d="M2.29297 1.55316C2.09877 1.55316 1.94141 1.71052 1.94141 1.90472V2.68126C1.94141 2.87546 2.09877 3.03282 2.29297 3.03282C2.48717 3.03282 2.64453 2.87546 2.64453 2.68126V1.90472C2.64453 1.71052 2.48717 1.55316 2.29297 1.55316Z" fill="#7E8BC8"/>
              <path d="M2.29297 4.65939C2.09877 4.65939 1.94141 4.81675 1.94141 5.01095V5.78748C1.94141 5.98169 2.09877 6.13904 2.29297 6.13904C2.48717 6.13904 2.64453 5.98169 2.64453 5.78748V5.01095C2.64453 4.8168 2.48717 4.65939 2.29297 4.65939Z" fill="#7E8BC8"/>
              <path d="M4.23442 3.49454H3.45789C3.26368 3.49454 3.10632 3.6519 3.10632 3.8461C3.10632 4.0403 3.26368 4.19766 3.45789 4.19766H4.23442C4.42862 4.19766 4.58598 4.0403 4.58598 3.8461C4.58598 3.6519 4.42862 3.49454 4.23442 3.49454Z" fill="#7E8BC8"/>
              <path d="M1.12809 3.49454H0.351562C0.157359 3.49454 0 3.6519 0 3.8461C0 4.0403 0.157359 4.19766 0.351562 4.19766H1.12809C1.3223 4.19766 1.47966 4.0403 1.47966 3.8461C1.47966 3.6519 1.3223 3.49454 1.12809 3.49454Z" fill="#7E8BC8"/>
          </svg>
        </div>
        <div class="theme-bg"></div>
      </div>
    </div>
  </div> <!-- header -->

  <div class="nav" id="navigation">
    <div class="nav__scrollable">
      <a class="btn btn-outline-danger" href="../index.html"><i class="fa fa-chevron-left"></i> Index</a>

      <h2>Contents</h2>
      <ul>
        <li><a href="#Network_manager">Network manager </a></li>
        <li><a href="#Master_server">Master-server </a></li>
        <li><a href="#Connection_protocol">Connection protocol </a></li>
        <li><a href="#Clients">Clients </a></li>
        <li><a href="#Events_and_game_protocol">Events and game protocol </a></li>
        <li><a href="#Rollbacks">Rollbacks </a></li>
        <li><a href="#Inputs">Inputs </a></li>
        <li><a href="#Desync">Desync </a></li>
      </ul>


      <h2>Manual</h2>
      <ul class="">
        <li><a href="../manual/readme.md.html">About L2DF</a></li>
        <li><a href="../manual/01-introduction.md.html">Introduction</a></li>
        <li><a href="../manual/02-presets.md.html">Presets</a></li>
        <li><a href="../manual/03-syntax.md.html">Data syntax</a></li>
        <li><a href="../manual/04-managers.md.html">Managers</a></li>
        <li><a href="../manual/05-ecs.md.html">Entity-Component system</a></li>
        <li><a href="../manual/06-ui.md.html">User Interface</a></li>
        <li><a href="../manual/07-frames.md.html">Animation (frames)</a></li>
        <li><a href="../manual/07-states.md.html">Game logic (states)</a></li>
        <li><a href="../manual/08-itr-body-kinds.md.html">Collision detection (kinds)</a></li>
        <li><strong>Networking</strong></li>
        <li><a href="../manual/10-masters-protocol.md.html">Master-servers' protocol</a></li>
      </ul>
      <h2>Modules</h2>
      <ul class="nowrap">
        <li><a href="../modules/l2df.config.html">l2df.config</a></li>
        <li><a href="../modules/l2df.core.html">l2df.core</a></li>
        <li><a href="../modules/l2df.helper.html">l2df.helper</a></li>
        <li><a href="../modules/l2df.html">l2df</a></li>
      </ul>
      <h2>Classes</h2>
      <ul class="nowrap">
        <li><a href="../classes/l2df.class.client.html">l2df.class.client</a></li>
        <li><a href="../classes/l2df.class.component.behaviour.html">l2df.class.component.behaviour</a></li>
        <li><a href="../classes/l2df.class.component.camera.html">l2df.class.component.camera</a></li>
        <li><a href="../classes/l2df.class.component.collision.html">l2df.class.component.collision</a></li>
        <li><a href="../classes/l2df.class.component.controller.html">l2df.class.component.controller</a></li>
        <li><a href="../classes/l2df.class.component.frames.html">l2df.class.component.frames</a></li>
        <li><a href="../classes/l2df.class.component.html">l2df.class.component</a></li>
        <li><a href="../classes/l2df.class.component.physix.cube.html">l2df.class.component.physix.cube</a></li>
        <li><a href="../classes/l2df.class.component.physix.grid.html">l2df.class.component.physix.grid</a></li>
        <li><a href="../classes/l2df.class.component.physix.html">l2df.class.component.physix</a></li>
        <li><a href="../classes/l2df.class.component.physix.world.html">l2df.class.component.physix.world</a></li>
        <li><a href="../classes/l2df.class.component.print.html">l2df.class.component.print</a></li>
        <li><a href="../classes/l2df.class.component.render.html">l2df.class.component.render</a></li>
        <li><a href="../classes/l2df.class.component.sound.html">l2df.class.component.sound</a></li>
        <li><a href="../classes/l2df.class.component.states.html">l2df.class.component.states</a></li>
        <li><a href="../classes/l2df.class.component.transform.html">l2df.class.component.transform</a></li>
        <li><a href="../classes/l2df.class.component.video.html">l2df.class.component.video</a></li>
        <li><a href="../classes/l2df.class.entity.html">l2df.class.entity</a></li>
        <li><a href="../classes/l2df.class.entity.map.html">l2df.class.entity.map</a></li>
        <li><a href="../classes/l2df.class.entity.object.html">l2df.class.entity.object</a></li>
        <li><a href="../classes/l2df.class.entity.scene.html">l2df.class.entity.scene</a></li>
        <li><a href="../classes/l2df.class.entity.ui.html">l2df.class.entity.ui</a></li>
        <li><a href="../classes/l2df.class.html">l2df.class</a></li>
        <li><a href="../classes/l2df.class.logger.html">l2df.class.logger</a></li>
        <li><a href="../classes/l2df.class.parser.dat.html">l2df.class.parser.dat <sup>(deprecated)</sup></a></li>
        <li><a href="../classes/l2df.class.parser.html">l2df.class.parser</a></li>
        <li><a href="../classes/l2df.class.parser.json.html">l2df.class.parser.json</a></li>
        <li><a href="../classes/l2df.class.parser.lffs.html">l2df.class.parser.lffs <sup>(deprecated)</sup></a></li>
        <li><a href="../classes/l2df.class.parser.lffs2.html">l2df.class.parser.lffs2</a></li>
        <li><a href="../classes/l2df.class.plug.html">l2df.class.plug</a></li>
        <li><a href="../classes/l2df.class.storage.html">l2df.class.storage</a></li>
        <li><a href="../classes/l2df.class.storage.ordered.html">l2df.class.storage.ordered</a></li>
        <li><a href="../classes/l2df.class.timer.html">l2df.class.timer</a></li>
        <li><a href="../classes/l2df.class.transform.html">l2df.class.transform</a></li>
        <li><a href="../classes/l2df.manager.event.html">l2df.manager.event</a></li>
        <li><a href="../classes/l2df.manager.factory.html">l2df.manager.factory</a></li>
        <li><a href="../classes/l2df.manager.group.html">l2df.manager.group</a></li>
        <li><a href="../classes/l2df.manager.gsid.html">l2df.manager.gsid</a></li>
        <li><a href="../classes/l2df.manager.input.html">l2df.manager.input</a></li>
        <li><a href="../classes/l2df.manager.kinds.html">l2df.manager.kinds</a></li>
        <li><a href="../classes/l2df.manager.network.html">l2df.manager.network</a></li>
        <li><a href="../classes/l2df.manager.physix.html">l2df.manager.physix</a></li>
        <li><a href="../classes/l2df.manager.recorder.html">l2df.manager.recorder</a></li>
        <li><a href="../classes/l2df.manager.render.html">l2df.manager.render</a></li>
        <li><a href="../classes/l2df.manager.resource.html">l2df.manager.resource</a></li>
        <li><a href="../classes/l2df.manager.scene.html">l2df.manager.scene</a></li>
        <li><a href="../classes/l2df.manager.sound.html">l2df.manager.sound</a></li>
        <li><a href="../classes/l2df.manager.states.html">l2df.manager.states</a></li>
        <li><a href="../classes/l2df.manager.sync.html">l2df.manager.sync</a></li>
      </ul>
    </div> <!-- nav__scrollable -->
  </div> <!-- navigation -->


  <div class="content" id="content">


<h1>Networking</h1>

<p>Nowadays online multiplayer in games is not a feature, but a requirement.
Everyday gamers play numbers of hours, matches and sessions in their favourite games with friends and other people.</p>

<p>L2DF can be used with both host-clients and peer-to-peer multiplayer model. <br />
For the last one we also provide you a bunch of tools to implement rollback based networking<sup><a href="http://blog.hypersect.com/rollback-networking-in-inversus/">[1]</a></sup><sup><a href="http://mauve.mizuumi.net/2012/07/05/understanding-fighting-game-networking/">[2]</a></sup><sup><a href="https://en.wikipedia.org/wiki/GGPO">[3]</a></sup>.
Also we want to note that we don't like (hate) lockstep networking and we'll skip it in this topic.</p>


<p><a name="Network_manager"></a></p>
<h2>Network manager</h2>

<p>As we discussed in <a href="../manual/04-managers.md.html#">previous topic</a> L2DF has <a href="../classes/l2df.manager.network.html#">NetworkManager</a> which you can use
to easily enable multiplayer for your game.</p>

<p>It has various of methods which you can find and learn in its <a href="../classes/l2df.manager.network.html#">API reference</a>.
Most important one is <a href="../classes/l2df.manager.network.html#Manager:init">NetworkManager:init</a> since its your starting point in every
multiplayer implementation. It does these two things:</p>

<ul>
    <li>initializes local player's username adding "#xxxx" suffix to it, so other players can find you later with this username;</li>
    <li>initializes your socket<sup><a href="https://en.wikipedia.org/wiki/Network_socket">[4]</a></sup> to connect masters and peers later.</li>
</ul>

<p>To get generated username use <a href="../classes/l2df.manager.network.html#">NetworkManager.username</a> variable.</p>

<p>To init it again you can destroy old socket and other stuff with <a href="../classes/l2df.manager.network.html#Manager:destroy">NetworkManager:destroy</a> method.</p>

<p>On top of that L2DF uses <code>lua-enet</code> which is a part of LOVE framework.
Read more about that <a href="https://love2d.org/wiki/lua-enet">here</a> for advanced networking use-cases.</p>


<p><a name="Master_server"></a></p>
<h2>Master-server</h2>

<p>To implement online matchmaking and make finding of players possible L2DF uses <a href="https://github.com/atom-tm/l2df-master">master-servers</a>.</p>

<p>It works as simple as it is:</p>

<ol>
    <li>Player connects to master and sends its username.</li>
    <li>Master registers user, so now others can find him by username.</li>
    <li>Player wants to find another player / his lobby and sends his username:
    <ul>
        <li>if noone was found add this player to it's own lobby;</li>
        <li>if someone was found then join his lobby = connect to each user in the lobby (peer-to-peer);</li>
        <li>if everything is like in the previous variant, but current user is already connected to lobby then he should
        leave lobby first = disconnect from all clients (internally master sends <code>FLUSH</code> event for doing that).</li>
    </ul></li>
    <li>In lobby users can wait for other players or start game immediately - depends on your implementation / preset.</li>
    <li>If somebody disconnects from master it will be removed from lobby BUT not from other peers. It's used to not overload
    master-servers and "localize" lobbies after game startups - so nobody else can connect after game starts.</li>
    <li>If the last user in lobby disconnects master'll destroy this lobby.</li>
</ol>

<p>We support multiple master-server at the same time so you can create "mirrors", "fallbacks", "public and private" and
other types of masters - it's up to you how you will use this feature.</p>

<p>To add new master-server to your network's list <a href="../classes/l2df.manager.network.html#Manager:register">NetworkManager:register</a> method.
Host format is <code>X.X.X.X:PORT</code> where <code>X</code> is parts of master's public IP and <code>PORT</code> is master's port (default is 12565).</p>

<p>For debug purpose there're also <code>L2DF_MASTER</code> environment variable which you can use to add new master-server without
changing game's source code.</p>

<p>To connect all registered master-servers use <a href="../classes/l2df.manager.network.html#Manager:login">NetworkManager:login</a>. <br />
Disconnect from them: <a href="../classes/l2df.manager.network.html#Manager:logout">NetworkManager:logout</a></p>

<p>Except connecting to master <a href="../classes/l2df.manager.network.html#Manager:login">NetworkManager:login</a> also attempts to get your public IP
address (connects to google.com for that). It's used later to help setup connection between you and other players.</p>


<p><a name="Connection_protocol"></a></p>
<h2>Connection protocol</h2>

<p>For information about master-server's protocol read <a href="../manual/10-masters-protocol.md.html#">this page</a>.</p>

<p>As we already stated L2DF is adapted to be used in p2p networking. <br />
How it works in a perfect world:</p>

<p><img src="../img/p2p.png" alt="sync"/></p>

<p>But as you may know in real world most of the computers are located in local networks which use NAT.
The case for that is limited amount of IPv4 addresses (a little bit bigger than 4 billions).</p>

<p>There're no problems with NAT if you connect to somebody publicly available in the network (no NAT or with NAT forwarding; NONAT below).
But there're a big problem if somebody wants set connection with you first - it's impossible until you configure your NAT
to forward some specific connections (sometimes it's not possible).</p>

<p>Okay, imagine the worst (to be fair it's "common") case scenario: <br />
We have 2 computers under NAT (Wi-Fi, ISP, no matter what) and want to setup a connection. <br />
Is it possible? - Yes! Sometimes :)</p>

<p>NAT has different implementation and some of them works together, some not. <br />
Typical terms you can find about NAT: 1. full cone, 2. address-restricted, 3. port-restricted, 4. with hairpin, 5. no hairpin.</p>

<p>Okay, what are solutions?</p>

<ol>
    <li><p>NAT port forwarding / static routing: sometimes it's enough just to set correct routes on your router and you're done.</p></li>
    <li><p>UDP holepunching <a href="http://www.raknet.net/raknet/manual/natpunchthrough.html">[5]</a>: L2DF implements this technique
    and it's why we're using master-server. This is perfect except one problem: if you have 2+3 NAT (see above) it's very
    hard to setup connection since for different addresses NAT uses different ports on same socket which leads to problems -
    we have to "predict" port and it's not very efficient. Some illustration on how it works:</p></li>
</ol>

<p><img src="../img/holepunching.png" alt="holepunching"/></p>

<ol>
    <li><p>Use IPv6: if both of the clients have IPv6 address it's possible to setup connection using it since most of the ISPs
    provides them as publicly available without problems. Currently we're not supporting it.</p></li>
    <li><p>UPnP: if one the clients' router support this technology, you can use it to open needed ports and setup connection
    using it. May be implemented in L2DF in future.</p></li>
    <li><p>Relay servers: it's how Steam, Unity and others networking works. Relay servers (or TURN servers) transfer traffic
    between clients as if they are connected together. We're going to implement this in future.</p></li>
    <li><p>VPN: like previous one but more universal. It emulates "local network" so you can connect to anyone in these</p></li>
</ol>

<p>Sounds a little bit complicated. And it is :)</p>


<p><a name="Clients"></a></p>
<h2>Clients</h2>

<p>For each connected player L2DF creates a <a href="../classes/l2df.class.client.html#">Client</a> instance which contains a references to connected
peer and useful methods to communicate with it.</p>

<p><a href="../classes/l2df.class.client.html#">Client</a> is a first argument in all event's callback functions.</p>

<p>You can get an iterator for all connected clients with <a href="../classes/l2df.manager.network.html#Manager:clients">NetworkManager:clients</a> method and
use it, e.g. like this:</p>


<pre>
<span class="keyword">for</span> client <span class="keyword">in</span> NetworkManager:clients() <span class="keyword">do</span>
    <span class="global">print</span>(<span class="string">'Connected to'</span>, client:username())
<span class="keyword">end</span>
</pre>



<p><a name="Events_and_game_protocol"></a></p>
<h2>Events and game protocol</h2>

<p>To organize your communication between clients L2DF provides <a href="../classes/l2df.manager.network.html#Manager:event">NetworkManager:event</a> method.</p>

<p>This method registers network event that can be sent later with <a href="../classes/l2df.manager.network.html#Manager:broadcast">NetworkManager:broadcast</a>
and <a href="../classes/l2df.class.client.html#">Client:send</a> methods.</p>

<p>Simple usage:</p>


<pre>
NetworkManager:event(<span class="string">'hello'</span>, <span class="string">'Is'</span>, <span class="keyword">function</span> (client, event, index, message)
    <span class="global">print</span>(<span class="string">'Hello'</span>, message, <span class="string">'your index is'</span>, index, <span class="string">'for that client.'</span>)
<span class="keyword">end</span>)

<span class="comment">-- ...
</span>
<span class="keyword">local</span> i = <span class="number">1</span>
<span class="keyword">local</span> msg = <span class="string">'from '</span> .. NetworkManager:username()
<span class="keyword">for</span> client <span class="keyword">in</span> NetworkManager:clients() <span class="keyword">do</span>
    client:send(<span class="string">'hello'</span>, i, msg)
    i = i + <span class="number">1</span>
<span class="keyword">end</span>
</pre>


<p>The above example can be simplified with <a href="../classes/l2df.manager.network.html#Manager:broadcast">NetworkManager:broadcast</a> method since
it also sends event with parameters to all connected clients.</p>

<p>NetworkManager:event's format argument (second) defines a package structure that would be sent across network. <br />
All defined variables will be unpacked and passed to callback function after <a href="../classes/l2df.class.client.html#">Client</a> and enet's event references.<br />
There're description of all available types for it:</p>

<pre><code> "b" a signed char (1 byte).
 "B" an unsigned char (1 byte).
 "h" a signed short (2 bytes).
 "H" an unsigned short (2 bytes).
 "i" a signed int (4 bytes).
 "I" an unsigned int (4 bytes).
 "l" a signed long (8 bytes).
 "L" an unsigned long (8 bytes).
 "f" a float (4 bytes).
 "d" a double (8 bytes).
 "s" a zero-terminated string.
 "cn" a sequence of exactly n chars corresponding to a single Lua string.
</code></pre>


<p>See more examples in <a href="../manual/02-presets.md.html#">LF2&apos;s preset</a>.</p>

<p><b>**Please, note that all calls to <a href="../classes/l2df.manager.network.html#Manager:event">NetworkManager:event</a> should be declared in global scope or
should always have the defined order of execution (no if statements that can differ on clients) since it defined your
protocol! Changes made to it lead to changes of your protocol and game versions' netcode incompatibility.**</b></p>


<p><a name="Rollbacks"></a></p>
<h2>Rollbacks</h2>

<h3>How it works</h3>

<p>Before getting into the implementation details, let’s review how rollback networking functions at a high-level.</p>

<p>Rollback networking an evolution of synchronous networking systems where every player would send input commands
to every other player. The last ones are also known as "lockstep" systems. Little Fighter 2 is an example of the game
which uses this type of networking. A deterministic game simulation in LF2 would advance one frame every time it had
received commands from each peer. This architecture had numerous benefits, but one huge caveat that drove action games
away from it: input latency. In order to allow time for receiving remote player input, the local input wouldn’t be
injected into the simulation for a number of frames equal to the transfer speed.</p>

<p><img src="../img/Sync.png" alt="sync"/></p>

<p>Rollback fixes the latency issue by processing local inputs immediately while predicting the remote inputs.
When the actual remote inputs arrive over the network, it checks if anything was mispredicted.
If a misprediction was found, time will be rewound to the mispredicted frame and then simulated back to the present
using the corrected input values and further predicted values. This rollback and correction process all happens in
the span of a single frame such that user only sees a slight pop in the results.</p>

<p><img src="../img/Rollback.png" alt="rollback"/></p>

<p>As network latency increases, visual pops in motion will increase, but they will only be in relation to direct
effects of remote player input. For example, the launching of a projectile might skip the first couple frames,
but once the projectile is in flight it can be reacted to exactly as if it were in a local multiplayer game.</p>

<p>Rollback networking is designed to create a near zero latency experience for the local user and fair conflict
resolution because every participant’s inputs are respected. When you move, you move right away. If you press
a button on a specific frame to counter an attack, you will counter the attack. This architecture also creates
a minimal overlap in which game and network code need to consider one another. When adding features to the game,
there is almost zero concern about networking
Everything just works and that’s a rather freeing experience for the engineer.</p>

<p>The main downsides of rollback are that it does not easily support joining in-progress matches, and it does not scale
to large player counts. It also doesn’t support a variable frame rate simulation, but I’ll discuss how it can still
support variable frame rate rendering later.</p>

<p>Rollback is perfect for fast, twitchy, frame-accurate games that require responsive input and have short gameplay rounds.
It is the standard approach for modern fighting games and should be the standard approach for any quick round-based
game with direct player interaction.</p>


<h3>How to implement</h3>

<p><a href="../classes/l2df.manager.sync.html#">SyncManager</a> - provides you a transactional storage with commit / rollback support. <br />
<a href="../classes/l2df.manager.input.html#">InputManager</a> - saves 'timestamp' for all your inputs which is used internally to rollback with
<a href="../classes/l2df.manager.sync.html#">SyncManager</a> <br />
<a href="../classes/l2df.class.entity.html#Entity:sync">Entity:sync</a> - can be used in pair with <a href="../classes/l2df.manager.sync.html#Manager:stage">SyncManager:stage</a> to
persist entity's state for future rollbacks.</p>

<p>For more detailed information on implementation see <a href="../manual/02-presets.md.html#">LF2&apos;s preset</a>.</p>


<p><a name="Inputs"></a></p>
<h2>Inputs</h2>

<p>This section has not completed yet...</p>


<p><a name="Desync"></a></p>
<h2>Desync</h2>

<p>There're 3 variants depending on your chosen solution:</p>

<ol>
    <li>Server-Client: if you implemented this type of networking there're no desync since all logic is processed on the server
    and your clients become just a readers of the game state from the server, cheating depends on the server (usually hard).
    Requires pretty good machine with publicly available IP to start and process multiple matches at the same time.</li>
    <li>Host-Client: no desync and delay on host and some delay on all clients, host can cheat easily.</li>
    <li>Peer-to-Peer: in this case you have at least three different models:
    <ul>
        <li>simple sync of all objects: no delay for local player, easy to cheat, high bandwidth usage;</li>
        <li>lockstep simulation: desync depends on determinism, hard to cheat, high input lag, low bandwidth usage, the worst user experience;</li>
        <li>rollback networking: no delay for local player, cheating leads to desync, low bandwidth usage.</li>
    </ul></li>
</ol>

<p>Now we want to cover only the last section about rollback netcode.</p>


<p>To avoid desync with this type of networking you should follow these requirements:</p>

<ol>
    <li>Game simulation MUST be deterministic: same floating point operations on different machines, no random, no undefined
    behaviour, same game loops and order of execution with the same input.</li>
    <li>Game clocks (at least from start of the simulation) should be synchonized as accurate as possible.</li>
    <li>If you recognized desync you should do one of these things:
    <ul>
        <li>netpause, sync clocks and world;</li>
        <li>sync the whole world or its parts from time to time;</li>
        <li>interupt game session.</li>
    </ul></li>
</ol>

<p>Later we will provide your examples of situations when there're could be desync and explain how to avoid it.</p>


<h4>References:</h4>

<p>[1] Rollback Networking in INVERSUS - <a href="http://blog.hypersect.com/rollback-networking-in-inversus/">http://blog.hypersect.com/rollback-networking-in-inversus/</a></p>

<p>[2] Understanding Fighting Game Networking - <a href="http://mauve.mizuumi.net/2012/07/05/understanding-fighting-game-networking/">http://mauve.mizuumi.net/2012/07/05/understanding-fighting-game-networking/</a></p>

<p>[3] GGPO - <a href="https://en.wikipedia.org/wiki/GGPO">https://en.wikipedia.org/wiki/GGPO</a></p>

<p>[4] Network socket - <a href="https://en.wikipedia.org/wiki/Network_socket">https://en.wikipedia.org/wiki/Network_socket</a></p>

<p>[5] NAT Punch-through - <a href="http://www.raknet.net/raknet/manual/natpunchthrough.html">http://www.raknet.net/raknet/manual/natpunchthrough.html</a></p>


  <div id="about" class="about">
    <span class="meta"><i class="far fa-clock"></i> Last updated 2021-07-14 04:04:51</span>
  </div> <!-- about -->

  </div> <!-- content -->
</div> <!-- container -->

  <script src="../js/theme.js" async></script>
  <script src="../js/spacer.js" async></script>
  <script src="../js/dc-code.js" async></script>
<!-- <script src="https://atom-tm.github.io/l2df-engine/js/dc-code.js" async></script> -->
</body>
</html>
