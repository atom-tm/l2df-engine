<!DOCTYPE html>
<html>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<head>
    <title>L2DF documentation</title>
    <link rel="stylesheet" href="../ldoc.css" type="text/css" />
</head>
<body>

<div id="container">

<div id="product">
    <div id="product_logo"></div>
    <div id="product_name"><big><b></b></big></div>
    <div id="product_description"></div>
</div> <!-- id="product" -->


<div id="main">


<!-- Menu -->

<div id="navigation">
<br/>
<h1>L2DF</h1>

<ul>
  <li><a href="../index.html">Index</a></li>
</ul>

<h2>Contents</h2>
<ul>
<li><a href="#__________">Блоки </a></li>
<li><a href="#___________________________________">Описание структуры </a></li>
</ul>


<h2>Manual</h2>
<ul class="nowrap">
  <li><strong>Love2D Fighting Engine</strong></li>
</ul>
<h2>Reference</h2>
<ul class="nowrap">
  <li><a href="../reference/l2df.core.html">l2df.core</a></li>
  <li><a href="../reference/l2df.helper.html">l2df.helper</a></li>
  <li><a href="../reference/l2df.html">l2df</a></li>
</ul>
<h2>Classes</h2>
<ul class="nowrap">
  <li><a href="../classes/l2df.core.class.component.frames.html">l2df.core.class.component.frames</a></li>
  <li><a href="../classes/l2df.core.class.component.html">l2df.core.class.component</a></li>
  <li><a href="../classes/l2df.core.class.component.physix.html">l2df.core.class.component.physix</a></li>
  <li><a href="../classes/l2df.core.class.component.print.html">l2df.core.class.component.print</a></li>
  <li><a href="../classes/l2df.core.class.component.render.html">l2df.core.class.component.render</a></li>
  <li><a href="../classes/l2df.core.class.component.states.html">l2df.core.class.component.states</a></li>
  <li><a href="../classes/l2df.core.class.component.transform.html">l2df.core.class.component.transform</a></li>
  <li><a href="../classes/l2df.core.class.entity.frame.html">l2df.core.class.entity.frame</a></li>
  <li><a href="../classes/l2df.core.class.entity.html">l2df.core.class.entity</a></li>
  <li><a href="../classes/l2df.core.class.entity.object.html">l2df.core.class.entity.object</a></li>
  <li><a href="../classes/l2df.core.class.entity.scene.html">l2df.core.class.entity.scene</a></li>
  <li><a href="../classes/l2df.core.class.entity.ui.html">l2df.core.class.entity.ui</a></li>
  <li><a href="../classes/l2df.core.class.html">l2df.core.class</a></li>
  <li><a href="../classes/l2df.core.class.state.html">l2df.core.class.state</a></li>
  <li><a href="../classes/l2df.core.class.storage.html">l2df.core.class.storage</a></li>
  <li><a href="../classes/l2df.core.class.timer.html">l2df.core.class.timer</a></li>
  <li><a href="../classes/l2df.core.class.transform.html">l2df.core.class.transform</a></li>
  <li><a href="../classes/l2df.core.manager.entity.html">l2df.core.manager.entity</a></li>
  <li><a href="../classes/l2df.core.manager.event.html">l2df.core.manager.event</a></li>
  <li><a href="../classes/l2df.core.manager.group.html">l2df.core.manager.group</a></li>
  <li><a href="../classes/l2df.core.manager.render.html">l2df.core.manager.render</a></li>
  <li><a href="../classes/l2df.core.manager.resource.html">l2df.core.manager.resource</a></li>
  <li><a href="../classes/l2df.core.manager.scene.html">l2df.core.manager.scene</a></li>
  <li><a href="../classes/l2df.core.manager.settings.html">l2df.core.manager.settings</a></li>
  <li><a href="../classes/l2df.core.manager.states.html">l2df.core.manager.states</a></li>
  <li><a href="../classes/l2df.parsers.base.html">l2df.parsers.base</a></li>
  <li><a href="../classes/l2df.parsers.dat.html">l2df.parsers.dat</a></li>
  <li><a href="../classes/l2df.parsers.json.html">l2df.parsers.json</a></li>
  <li><a href="../classes/l2df.parsers.lffs.html">l2df.parsers.lffs</a></li>
</ul>

</div>

<div id="content">


<h1>Love2D Fighting Engine</h1>

<p>Небольшой движок для игр в жанре Beat 'em up и fighting на основе фреймворка Love2d.</p>

<p><a name="__________"></a></p>
<h2>Блоки</h2>

<h3>Opoint</h3>

<p><em>Opoint</em> - блок отвечающий за создание объектов. Располагается в блоке *\<frame\>* объекта, поддерживает многоразовое использование.</p>

<p><em>Все opoint блоки обрабатываются во время первого тика каждого кадра.</em></p>

<blockquote>
    <p><strong>id</strong> (int) - id призываемого объекта</p>

    <p><strong>action</strong> (int) - кадр в котором появляется объект</p>

    <p><strong>action_random</strong> (int) - случайное смещение кадров</p>

    <p><strong>x</strong>, <strong>y</strong>, <strong>z</strong> (int) - положение призываемого объекта по осям x, y, z, относительно положения призывающего объекта</p>

    <p><strong>x_random</strong>, <strong>y_random</strong>, <strong>z_random</strong> (int) - случайное смещение по осям, относительно положения призываемого объекта</p>

    <p><strong>facing</strong> (int) - направление взгляда призываемого объекта, относительно призывающего</p>

    <p><strong>count</strong> (int) - количество призываемых объектов в одной точке</p>
</blockquote>

<h3>Body</h3>

<p><em>Body</em> - блок отвечающий за коллайдер "тела" объекта. "Тело" взаимодействует с другими коллайдерами, такими как <em>itr</em>. Блок <em>body</em> располагается внутри блока *\<frame\>* объекта, поддерживает многоразовое использование.</p>

<p><em>Чаще всего блок body используется в связки с itr блоком вражеского объекта, для перевода обладателя в кадры получения урона</em></p>

<blockquote>
    <p><strong>x</strong>, <strong>y</strong> (int) - координаты расположения тела, относительно объекта</p>

    <p><strong>w</strong>, <strong>h</strong> (int) - ширина и высота коллайдера</p>

    <p><strong>injury_frame</strong> (int) - кадр в который перейдёт объект при получении урона <em>если данный параметр не указан, объект перейдёт в стандарные кадры получения урона</em></p>

    <p><strong>untouchable</strong> (bool) - если данный параметр обозначен как <em>true</em>, тело становится недоступно для взаимодействия со стандартным <em>itr</em></p>
</blockquote>


<p><a name="___________________________________"></a></p>
<h2>Описание структуры</h2>

<p>Ниже приведено примерное описание структуры движка.</p>

<ul>
    <li>СИСТЕМНЫЕ папки и файлы заданы для движка по умолчанию, без них он не будет работать</li>
    <li>МОДУЛЬНАЯ папки и файлы можно удалять, переименовывать или изменять.
    Пути до файлов, содержащихся в этих папках прописываются в системных файлах.</li>
</ul>

<p>Сейчас в проекте имеются следующие элементы:</p>

<ul>
    <li>bg - МОДУЛЬНАЯ папка с картами, в ней хранятся все арены игры

<pre>
* test-arena - пример папки с ареной
    Арена состоит из dat файла, в котором описаны слои этой арены и фильтры (слои, накладывающиеся сверху), также там описываются свойства карты, такие как гравитация, трение, ширина итд, задаются локальные источники освящения, координаты спавнов. К картам можно подключать файлы <span class="string">"эффектов"</span>, чтобы на каждой карте эффекты были собственные, иначе берется стандартный файл эффектов.
</pre>
</li>
    <li>chars - МОДУЛЬНАЯ папка с персонажами, там каждому чару выделено по папочке, где собраны все требуемые только им датки и спрайты

<pre>
- test-char - пример персонажа
    - sprites - папка содержит все спрайты персонажа
    - ai.lua - набор инструкций поведения персонажа, если за него играет компьютер
    - main.dat / character.dat - файл описания перса
        датник персонажа имеет следующую структуру:
        - head - в этом теге задаются системные значения, например пути до спрайтов, имя, стартовое и максимальное здоровье, регенерация и прочее
        - frames_list - в этом теге задаются кадры <span class="string">"по умолчанию"</span> (о них подробнее ниже)
        - dtypes_list - в этом теге задаются типы урона (о них подробнее ниже)
        - variables - локальные для каждого персонажа переменные, которые могут использоваться, допустим, в ai или стейтах
        - frame - основной блок описывающий один кадр (или фрейм) персонажа. данных блоков можно создавать бесконечное количество, каждый из них имеет следующую структуру:
            - данные шапки - в основном они системные, если они не указаны, имеют по умолчанию <span class="number">0.</span> среди этих данных находятся, например, номер спрайта, смещение, следующий кадр, длительность этого кадра итд
            - блок стейта - таких блоков может быть несколько, тут задаются стейты и им передаются какие-то значения
            - блок тела - таких блоков может быть несколько, они отвечают за физическое тело персонажа, с которым будут происходить взаимодействия следующего блока
            - блок итерации - таких бло.. ну вы поняли.. отвечает за взаимодействия персонажей и объектов между собой. взаимодействие начинается когда блок итерации пересекается координатами с блоком тела. сценарий взаимодействия зависит от указанного типа <span class="string">"kind"</span> (кинды находятся в папке ниже)
            - блок вызова - таких бла бла... отвечает за создание объектов
    - head.png - аваратка персонажа (кажется в барах используется)
    - face.png - аватарка персонажа (а эта в меню выбора, ну или наоборот)
</pre>
</li>
    <li>data - СИСТЕМНАЯ папка, содержит основные файлы с настройками движка

<pre>
- combinations.dat - системный файл с описаниями доступных комбинаций, комбинации описываются как [код клавиш]:[текстовый идентефикатор]. допустим если написать <span class="number">314</span>:hit_Da, то при использовании в коде персонажа hit_Da: xxx, персонаж перейдет в кадр xxx, если друг за другом были нажаты клавиши, имеющие коды <span class="number">3</span>,<span class="number">1</span>,<span class="number">4.</span>
- damage_types.dat - системный файл, который описывает поведение персонажа при получении того или иного типа урона. к примеру при получении урона, который помечен как dtype: <span class="number">1</span>, персонаж перейдет в кадры, которые указаны в соответсвующем разделе данного файла. Если в файле нет какого-то типа урона, персонаж будет переходить в стандартные кадры, захардкоженные в движок. Также в каждом отдельном персонаже можно локально настроить поведение при тех или иных типах урона.
- data.txt - системный файл в котором описываются пути до персонажей, объектов и карт. каждому персонажу\\объекту\\карте присваевается свой id, по которому в дальнейшем происходит обращение
- english.lua - локализация, сделана в виде Lua таблички
- frames.dat - системный файл для задачи фреймов <span class="string">"по умолчанию"</span>. такие фреймы используются при написании стейтов (об этом далее), это типа текстовых ссылок. К примеру, если указать тут death: <span class="number">220</span>, то при обращении к кадру <span class="string">"death"</span>, персонажа будет переносить в кадр <span class="number">220</span> по умолчанию. В каждом отдельном персонаже можно локально задать тот или иной кадр.
- russian.lua - тоже локализация (их стоит в отдельную папку засунуть)
- settings.dat - системный файл с настройками игры (с ним ещё много мороки, поэтому без подробностей)
- sparks.dat - это системный датник спарков. они сделаны отдельными объектами, для реализации разных фич. обращение к кадрам этого датника происходит из файла damage_types.dat
- system.dat - тут задаются айдишники системных датников (сами пути прописаны в data.txt)
</pre>
</li>
    <li>docs - документация в html формате</li>
    <li>effects - МОДУЛЬНАЯ папка с датниками общих эффектов (взрывы там, брызги и так далее)</li>
    <li>kinds - СИСТЕМНАЯ папка, содержащая в себе сценарии взаимодействий

<pre>
- test-kind.lua - каждый такой файл имеет одинаковую структуру по умолчанию, которая состоит из функций
    - loadingBody - в этой функции задаётся считывание переменных, которые указываются в блоке тела в кадре персонажа и использутся в данном кинде далее
    - loadingItr - тоже самое, но для блока итерации
    - bodyCondition - дополнительные проверки, которые проходят при пересечении Itr<span class="string">'ом какого-либо Body (например проврека на то что был ударен враг, а не союзник)
    - itrCondition - тоже самое, но только когда два Itr'</span>а пересекаются (будет использовано, например, для столкновения ударов)
    - bodyProcessing - непосредственно сценарий взаимодействия персонажей
    - itrProcessing - сценарий столкновения персонажей
</pre>
</li>
    <li>libs - СИСТЕМНАЯ папка, содержащая в себе весь код движка

<pre>
- battle - в папке лежат модули используемые непосредсвтенно в бою
    - ai.lua - функции аи
    - collision.lua - столкновения, взаимодействия
    - control.lua - считывание нажатий, проверка нажатий, откаты нажатий итд
    - entities.lua - куча функций, всё что касается персонажей, создание, удаление, просчитывание хп, смена кадра итд
    - graphic.lua - отрисовка персонажей, их теней и отражений, а также поведение камеры
    - physix.lua - <span class="string">"физика"</span>. перемещения, проверки на пересечение границ карты, гравитация, трение
    - resources.lua - загрузка системных ресурсов используемых в бою, по хорошему половину этих ресурсов надо вынести в system.dat и грузить оттуда
- battle.lua - описание всего боя, общий процесс, что происходит в начале боя, смена карты и так далее
- data.lua - подгрузка всего из папки data, а также из системных папок стейтов и итераций
- fonts.lua - файл со шрифтами (временная реализация) и скриптом отрисовки текста
- helper.lua - вспомогательные функции
- gamera.lua - библиотека камеры
- images.lua - функции загрузки и отрисовки спрайтов
- localization.lua - не помню, что тут находится xD ну что-то про локализацию
- resources.lua - загрузка в память файлов персонажей и карт
- rooms.lua - основа для комнат (далее подробнее)
- settings.lua - загрузка настроек в память, функция по смене разрешения и сохранение настроек
- sounds.lua - функции загрузки и воспроизведения звуков
</pre>
</li>
    <li>music - МОДУЛЬНАЯ папка с музыкой</li>
    <li>objects - МОДУЛЬНАЯ папка с dat файлами объектов. структура объектов такая-же как и у персонажей, только type в шапке другой</li>
    <li>rooms - СИСТЕМНАЯ папка с файлами комнат. все комнаты задаются непосредственно в движке (файл libs/rooms.lua) а тут хранятся наборы поведения, ресурсов и прочего для тех или иных комнат. все комнаты имеют обязательные функции load, update и draw, а также свои локальные функции. в зависимости от того, какая сейчас комната, выполняется тот или иной набор данных функций</li>
    <li>sounds - МОДУЛЬНАЯ папка со звуками</li>
    <li>sprites - МОДУЛЬНАЯ папка со спрайтами (однако пока там находится СИСТЕМНАЯ папка с интерфейсами, но это скоро будет доработано)

<pre>
- UI - папка содержащая все элементы интерфейса
- filter.png - фильтр <span class="string">"освящения"</span>
</pre>
</li>
    <li>states - СИСТЕМНАЯ папка с описаниями сценариев стейтов. каждый персонаж может единовреемнно иметь несколько стейтов в своём кадре. для каждого из указанных стейтов выполняется функция Processing. Также в шапке персонажа можно подключить "пассивные" стейты, у которых каждый тик будет выполняться функция Update. Стейт может быть и пассивным и активным одновременно. Например стейт блока, который повышает защиту персонажа, когда активен и имеет функцию снятия добавленной защиты и пассивный таймер, чтобы блоком не спамили.</li>
</ul>


</div> <!-- id="content" -->
</div> <!-- id="main" -->
<div id="about">
<i style="float:right;">Last updated 2019-10-17 12:47:26 </i>
</div> <!-- id="about" -->
</div> <!-- id="container" -->
</body>
</html>
